#!/bin/sh
set -e

. ./config.subr

echo "# sources.mk generated by update_sources" > ${SOURCES_MK}
echo "# sources.sh generated by update_sources" > ${SOURCES_SH}

C3_CONFIGURES="$(find c3c c3s ic3 libc3 test ucd2c -name configure -or -name update_sources)"
C3_CONFIGURES="$(echo "${C3_CONFIGURES}" | tr '\n' ' ')"
C3_CONFIGURES="${C3_CONFIGURES} libtommath/configure"
echo "C3_CONFIGURES = $C3_CONFIGURES" >> ${SOURCES_MK}
echo "C3_CONFIGURES='$C3_CONFIGURES'" >> ${SOURCES_SH}

C3_MAKEFILES="$(find c3c c3s ic3 libc3 test ucd2c -name Makefile)"
C3_MAKEFILES="$(echo "${C3_MAKEFILES}" | tr '\n' ' ')"
C3_MAKEFILES="${C3_MAKEFILES} libtommath/Makefile"
echo "C3_MAKEFILES = $C3_MAKEFILES" >> ${SOURCES_MK}
echo "C3_MAKEFILES='$C3_MAKEFILES'" >> ${SOURCES_SH}

C3_C_SOURCES="$(find c3c c3s ic3 libc3 test -name "[a-z]*.c" -or -name "[a-z]*.h" -or -name "[a-z]*.c.in" -or -name "[a-z]*.h.in")"
C3_C_SOURCES="$(echo "${C3_C_SOURCES}" | tr '\n' ' ')"
C3_C_SOURCES="$C3_C_SOURCES ucd2c/ucd.h ucd2c/ucd2c.c"
echo "C3_C_SOURCES = $C3_C_SOURCES" >> ${SOURCES_MK}
echo "C3_C_SOURCES='$C3_C_SOURCES'" >> ${SOURCES_SH}

update_sources_mk
update_sources_sh

( cd libtommath && ./update_sources; )
( cd libc3 && ./update_sources; )
( cd ic3 && ./update_sources; )
( cd c3s && ./update_sources; )
( cd test && ./update_sources; )
